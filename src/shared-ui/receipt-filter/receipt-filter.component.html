<app-dialog [headerText]="headerText">
  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Date',
      fieldName: 'date',
      type: 'date'
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Name',
      fieldName: 'name',
      type: 'text'
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Paid by',
      fieldName: 'paidBy',
      type: 'users',
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Amount',
      fieldName: 'amount',
      type: 'number',
      isCurrency: true,
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Categories',
      fieldName: 'categories',
      type: 'list',
      options: categories,
      optionFilterKey: 'name',
      optionDisplayKey: 'name',
      optionValueKey: 'id',
      multiple: true
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Tags',
      fieldName: 'tags',
      type: 'list',
      options: tags,
      optionFilterKey: 'name',
      optionDisplayKey: 'name',
      optionValueKey: 'id',
      multiple: true
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Status',
      fieldName: 'status',
      type: 'list',
      options: receiptStatusOptions,
      optionFilterKey: 'value',
      optionValueKey: 'value',
      optionDisplayKey: 'displayValue',
      multiple: true
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="filterField"
    [ngTemplateOutletContext]="{
      label: 'Resolved Date',
      fieldName: 'resolvedDate',
      type: 'date'
    }"
  ></ng-template>

  <ng-template
    [ngTemplateOutlet]="footerTemplate ?? defaultFooter"
  ></ng-template>
</app-dialog>

<ng-template #defaultFooter>
  <app-dialog-footer
    submitButtonTooltip="Apply filter"
    [additionalButtonsTemplate]="resetButton"
    (submitClicked)="submitButtonClicked()"
    (cancelClicked)="cancelButtonClicked()"
  ></app-dialog-footer>
</ng-template>

<ng-template
  #filterField
  let-label="label"
  let-fieldName="fieldName"
  let-type="type"
  let-isCurrency="isCurrency"
  let-options="options"
  let-optionFilterKey="optionFilterKey"
  let-multiple="multiple"
  let-optionDisplayKey="optionDisplayKey"
  let-optionValueKey="optionValueKey"
>
  <div class="d-flex">
    <app-input
      *ngIf="type === 'text' || type === 'number'"
      class="w-50"
      [label]="label"
      [isCurrency]="isCurrency"
      [inputFormControl]="form | formGet : fieldName + '.value'"
    ></app-input>
    <app-user-autocomplete
      *ngIf="type === 'users'"
      class="w-50"
      optionValueKey="id"
      [label]="label"
      [multiple]="true"
      [inputFormControl]="form | formGet : fieldName + '.value'"
    ></app-user-autocomplete>
    <app-datepicker
      *ngIf="type === 'date'"
      class="w-50"
      [label]="label"
      [inputFormControl]="form | formGet : fieldName + '.value'"
    >
    </app-datepicker>
    <app-autocomlete
      *ngIf="type === 'list'"
      class="w-50"
      [multiple]="multiple"
      [label]="label"
      [inputFormControl]="form | formGet : fieldName + '.value'"
      [options]="options"
      [optionValueKey]="optionValueKey"
      [optionFilterKey]="optionFilterKey"
      [optionDisplayKey]="optionDisplayKey"
    >
    </app-autocomlete>
    <app-select
      class="ms-2 w-50"
      label="Operation"
      [inputFormControl]="form | formGet : fieldName + '.operation'"
      [options]="type | operations"
    ></app-select>
  </div>
</ng-template>

<ng-template #resetButton>
  <app-button
    matButtonType="iconButton"
    icon="restart_alt"
    color="accent"
    tooltip="Reset filter"
    (clicked)="resetFilter()"
  ></app-button>
</ng-template>
