<div class="d-flex justify-content-between align-items center">
  <h2>{{ formConfig.headerText }}</h2>
</div>
<form
  [formGroup]="form"
  class="d-flex justify-content-between"
  (ngSubmit)="submit()"
>
  <div class="w-100">
    <div class="d-flex align-items-baseline">
      <div class="w-100 p-4">
        <app-form-section headerText="Group Details" [indent]="true">
          <app-input
            label="Group Name"
            [readonly]="formConfig.mode | inputReadonly"
            [inputFormControl]="form | formGet : 'name'"
          ></app-input>
          <app-select
            label="Status"
            [inputFormControl]="form | formGet : 'status'"
            [options]="groupStatusOptions"
          ></app-select>
        </app-form-section>
        <app-form-section
          headerText="Group Members"
          [headerButtonsTemplate]="buttonTemplate"
          [indent]="true"
        >
          <app-table
            [columns]="columns"
            [dataSource]="dataSource"
            [displayedColumns]="displayedColumns"
            (sorted)="sortName($event)"
          >
          </app-table>
        </app-form-section>
      </div>
      <app-form-button-bar>
        <app-back-button
          class="mb-4"
          tooltip="Return to list"
          [buttonRouterLink]="['/groups']"
        ></app-back-button>
        <app-edit-button
          *ngIf="formConfig.mode | inputReadonly"
          [disabled]="!(originalGroup?.id ?? 0 | groupRole : groupRole.OWNER)"
          [buttonRouterLink]="[editLink]"
        ></app-edit-button>
        <app-submit-button
          *ngIf="!(formConfig.mode | inputReadonly)"
          class="mb-4"
        ></app-submit-button>
        <app-cancel-button
          *ngIf="!(formConfig.mode | inputReadonly)"
          [routerLink]="['/groups']"
        ></app-cancel-button>
      </app-form-button-bar>
    </div>
  </div>
</form>

<ng-template #buttonTemplate>
  <app-button
    *ngIf="!(formConfig.mode | inputReadonly)"
    matButtonType="iconButton"
    icon="add"
    tooltip="Add User to Group"
    (clicked)="addGroupMemberClicked()"
  ></app-button>
</ng-template>

<ng-template #nameCell let-element="element">
  {{ (element.userId | user)?.displayName }}
</ng-template>

<ng-template #groupRoleCell let-element="element">
  {{ element.groupRole }}
</ng-template>

<ng-template #actionsCell let-index="index">
  <div class="d-flex">
    <app-delete-button
      tooltip="Remove group member"
      [disabled]="disableDeleteButton"
      (clicked)="removeGroupMember(index)"
    ></app-delete-button>
    <app-edit-button
      tooltip="Edit group member"
      (clicked)="editGroupMemberClicked(index)"
    ></app-edit-button>
  </div>
</ng-template>
