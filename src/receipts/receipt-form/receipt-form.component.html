<form [formGroup]="form" (ngSubmit)="submit()">
  <div class="d-flex">
    <div class="w-50">
      <ng-container *ngIf="imagesLoading">
        <div class="d-flex justify-content-center align-items-center">
          <mat-spinner></mat-spinner>
        </div>
      </ng-container>
      <app-carousel
        [images]="images"
        [mode]="mode"
        [disabled]="mode !== formMode.edit"
        (removeButtonClicked)="removeImage($event)"
      ></app-carousel>
      <app-upload-image
        [images]="images"
        [mode]="mode"
        [receiptId]="originalReceipt?.id?.toString()"
      >
      </app-upload-image>
    </div>
    <div class="w-50">
      <div class="d-flex justify-content-between form-container">
        <div
          class="d-flex flex-column justify-content-center align-items-center"
        >
          <app-input
            class="w-100"
            label="Name"
            [inputFormControl]="form | formGet : 'name'"
            [readonly]="mode | inputReadonly"
          ></app-input>
          <app-input
            class="w-100"
            label="Amount"
            type="number"
            [inputFormControl]="form | formGet : 'amount'"
            [readonly]="mode | inputReadonly"
          ></app-input>
          <app-autocomlete
            class="w-100"
            label="Categories"
            optionFilterKey="name"
            creatableValueKey="name"
            [inputFormControl]="form | formGet : 'categories'"
            [options]="categories"
            [optionTemplate]="categoryOptionTemplate"
            [optionChipTemplate]="categoryOptionTemplate"
            [multiple]="true"
            [creatable]="true"
            [readonly]="mode | inputReadonly"
          ></app-autocomlete>
          <app-autocomlete
            class="w-100"
            label="Tags"
            optionFilterKey="name"
            creatableValueKey="name"
            [inputFormControl]="form | formGet : 'tags'"
            [options]="tags"
            [optionTemplate]="tagOptionTemplate"
            [optionChipTemplate]="tagOptionTemplate"
            [multiple]="true"
            [creatable]="true"
            [readonly]="mode | inputReadonly"
          ></app-autocomlete>
          <app-datepicker
            label="Date"
            [inputFormControl]="form | formGet : 'date'"
            [readonly]="mode | inputReadonly"
          ></app-datepicker>
          <app-autocomlete
            class="w-100"
            label="Group"
            optionFilterKey="name"
            optionValueKey="id"
            [inputFormControl]="form | formGet : 'groupId'"
            [options]="(groups | async) ?? []"
            [optionTemplate]="groupOptionTemplate"
            [readonly]="mode | inputReadonly"
            [displayWith]="groupDisplayWith.bind(this)"
          ></app-autocomlete>
          <app-user-autocomplete
            #paidByAutocomplete
            class="w-100"
            label="Paid By"
            [inputFormControl]="form | formGet : 'paidByUserId'"
            [usersToOmit]="usersToOmit"
            [readonly]="mode | inputReadonly"
          ></app-user-autocomplete>
          <app-input
            class="w-100"
            label="Is Resolved"
            [inputFormControl]="form | formGet : 'isResolved'"
            [readonly]="mode | inputReadonly"
          ></app-input>
        </div>
        <app-form-button-bar>
          <app-button
            *ngIf="mode | inputReadonly"
            class="mb-4"
            matButtonType="iconButton"
            tooltip="Edit"
            icon="edit"
            [disabled]="
              !(originalReceipt?.groupId | groupRole : groupRole.EDITOR)
            "
            [routerLink]="[editLink]"
          ></app-button>
          <app-button
            *ngIf="!(mode | inputReadonly)"
            class="mb-4"
            matButtonType="iconButton"
            icon="add"
            tooltip="Upload Image"
            [disabled]="
              !(originalReceipt?.groupId | groupRole : groupRole.EDITOR)
            "
            (clicked)="uploadImageButtonClicked()"
          ></app-button>
          <app-button
            *ngIf="!(mode | inputReadonly)"
            class="mb-4"
            customIcon="split"
            matButtonType="iconButton"
            tooltip="Quick Actions"
            [disabled]="
              !(originalReceipt?.groupId | groupRole : groupRole.EDITOR)
            "
            (clicked)="openQuickActionsModal()"
          ></app-button>
          <app-submit-button
            *ngIf="!(mode | inputReadonly)"
            class="mb-4"
            [mode]="mode"
            [disabled]="
              !(originalReceipt?.groupId | groupRole : groupRole.EDITOR)
            "
          ></app-submit-button>
          <app-cancel-button
            *ngIf="!(mode | inputReadonly)"
            class="mb-4"
            [mode]="mode"
            [routerLink]="[cancelLink]"
          ></app-cancel-button>
        </app-form-button-bar>
      </div>
      <app-item-list [form]="form"></app-item-list>
      <app-receipt-comments
        [receiptId]="originalReceipt?.id"
        [comments]="originalReceipt?.comments ?? []"
        [mode]="mode"
      ></app-receipt-comments>
    </div>
  </div>
</form>

<ng-template #categoryOptionTemplate let-option="option"
  >{{ option.name }}
</ng-template>

<ng-template #tagOptionTemplate let-option="option"
  >{{ option.name }}
</ng-template>

<ng-template #groupOptionTemplate let-option="option"
  >{{ option.name }}
</ng-template>
